{% extends "_base.html" %}
{% from "_library.html" import connection_phase, badge, tls_mode_name %}
{% block body %}
<h1>{% trans %}Scan result #{{ scan_id }}{% endtrans %}</h1>
<dl>
	<div class="di">
		<dt>Domain</dt>
		<dd>{{ scan_info.domain }}</dd>
	</div>
	<div class="di">
		<dt>Start time</dt>
		<dd>{{ scan_info.created_at }}</dd>
	</div>
	<div class="di">
		<dt>Protocol</dt>
		<dd>{{ scan_info.protocol.value }}</dd>
	</div>
</dl>
<h2>Endpoint discovery</h2>
<h3>SRV records</h3>
{% if srv_records %}
<table class="wide">
	<thead>
		<tr>
			<th><abbr title="Priority">P</abbr></th>
			<th><abbr title="Weight">W</abbr></th>
			<th>Service</th>
			<th>Host</th>
			<th>Port</th>
		</tr>
	</thead>
	<tbody>
{% for prio, weight, service, host, port in srv_records %}
		<tr>
			<td class="numeric">{{ prio }}</td>
			<td class="numeric">{{ weight }}</td>
			<td>{{ service }}</td>
			<td>{{ host | decode_domain }}</td>
			<td class="numeric">{{ port }}</td>
		</tr>
{% endfor %}
	</tbody>
</table>
{% else %}
<p>{% trans %}No valid records found.{% endtrans %}</p>
{% endif %}
<h3><tt>_xmppconnect</tt> TXT records</h3>
{% if xmppconnect_records %}
<table class="wide">
	<thead>
		<tr>
			<th>Name</th>
			<th>Value</th>
		</tr>
	</thead>
	<tbody>
{% for name, value in xmppconnect_records %}
		<tr>
			<td>{{ name | printable_bytes }}</td>
			<td>{{ value | printable_bytes }}</td>
		</tr>
{% endfor %}
	</tbody>
</table>
{% else %}
<p>{% trans %}No valid records found.{% endtrans %}</p>
{% endif %}
<h3><tt>host-meta</tt></h3>
{% if host_meta_object_info %}
<dl>
{% for format_, url in host_meta_object_info %}
	<div class="di">
		<dt>{{ format_.value }}</dt>
		<dt><a href="{{ url }}">{{ url }}</a></dt>
	</div>
{% endfor %}
</dl>
{% if host_meta_links %}
<table class="wide">
	<thead>
		<tr>
			<th>Type</th>
			<th>URL</th>
			<th>Formats</th>
		</tr>
	</thead>
	<tbody>
{% for rel, href, formats in host_meta_links %}
		<tr>
			<td>{{ rel }}</td>
			<td>{{ href }}</td>
			<td><ul class="inline">
				{%- for format_ in formats -%}
					<li>{{ format_.value }}</li>
				{%- endfor -%}
			</ul></td>
		</tr>
{% endfor %}
	</tbody>
</table>
{% else %}
<p>{% trans %}No object contained any valid links.{% endtrans %}</p>
{% endif %}
{% else %}
<p>{% trans %}No valid host-meta objects found.{% endtrans %}</p>
{% endif %}
<h2>Endpoints</h2>
<table class="wide">
	<thead>
		<tr>
			<th>Origin</th>
			<th>Transport</th>
			<th>URI</th>
			<th>Mode</th>
			<th>Status</th>
		</tr>
	</thead>
	<tbody>
{% for source, transport, uri, mode, (in_progress, passed, error) in endpoints %}
		<tr>
			<td>{{ source }}</td>
			<td>{{ transport }}</td>
			<td>{{ uri }}</td>
			<td>{{ mode }}</td>
			<td>
				{%- if in_progress -%}
				{% call badge("gray") %}{% trans %}In progress{% endtrans %}{% endcall %}
				{%- else -%}
				{%- if passed -%}
				{% call badge("success") %}{% trans %}Passed{% endtrans %}{% endcall %}
				{%- else -%}
				{% call badge("error", title=error) %}{% trans %}Error{% endtrans %}{% endcall %}
				{%- endif -%}
				{%- endif -%}
			</td>
		</tr>
{% endfor %}
	</tbody>
</table>

<h2>Authentication</h2>
{% for phase, mechanisms in sasl_offerings.items() %}
<h3>{{ phase }}</h3>
{% if mechanisms %}
<ul>
{% for mechanism in mechanisms %}
	<li>{{ mechanism }}</li>
{% endfor %}
</ul>
{% else %}
<p>{% trans %}No SASL mechanisms offered.{% endtrans %}</p>
{% endif %}
{% endfor %}

<h2>TLS</h2>
<p>The TLS scan was executed against {{ tls_scan_uri }}.</p>
<h3>Versions</h3>
<table>
	<thead>
		<tr>
			<th>Version</th>
			<th>Offered</th>
		</tr>
	</thead>
	<tbody>
{% for label, score, offered in tls_offering_info %}
		<tr>
			<td>{{ label }}</td>
			<td>{% if offered is none %}?{% else %}{{ 'yes' if offered else 'no'}}{% endif %}</td>
		</tr>
{% endfor %}
	</tbody>
</table>
<h3>Certificate Chain</h3>
<ol>
{% for cert in cert_chain %}
	<li>
		<dl>
			<div class="di">
				<dt>Subject</dt>
				<dd>{{ cert.subject }}</dd>
			</div>
			<div class="di">
				<dt>Issuer</dt>
				<dd>{{ cert.issuer }}</dd>
			</div>
			<div class="di">
				<dt>Valid from</dt>
				<dd>{{ cert.not_before }}</dd>
			</div>
			<div class="di">
				<dt>Valid until</dt>
				<dd>{{ cert.not_after }}</dd>
			</div>
			{% for algo in cert.fingerprints %}
			<div class="di">
				<dt>{{ algo }} Fingerprint</dt>
				<dd>{{ cert.fingerprints[algo] | hexdigest }}</dd>
			</div>
			{% endfor %}
		</dl>
	</li>
{% endfor %}
</ol>
<h3>Ciphers</h3>
<dl>
	<dt>Cipher order</dt>
	<dd>{% if server_cipher_order is none %}?{% elif server_cipher_order %}Server side{% else %}Client side{% endif %}</dd>
</dl>
<table class="wide{% if ciphers | length > 3 %} long{% endif %}">
	<thead>
		<tr>
			<th>Name</th>
			<th>Info</th>
		</tr>
	</thead>
	<tbody>
{% for id_, name, info in ciphers %}
		<tr>
			<td>{{ name }}<span class="cipher-id"> (<code>{{ "0x%02x" | format(id_) }}</code>)</span></td>
			<td>{{ info }}</td>
		</tr>
{% endfor %}
	</tbody>
</table>
{% endblock %}
